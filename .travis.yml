language: python

python:
    - "2.7"
virtualenv:
    # required because we install the python-qt4 ubuntu package
    system_site_packages: true

install:
    # gui tests requirements
    # start xvfb to emulate a graphical session
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    # install PyQt4
    - sudo apt-get install python-qt4
    # install mozregression code and test dependencies
    - pip install coverage coveralls
    - cd gui && pip install -r test-requirements.txt && cd ..

before_script:
    flake8 mozregression tests setup.py

script:
    - coverage run setup.py test
    - cd gui && coverage run build.py test && cd ..
    # now combine the coverage data
    - mv .coverage .coverage.core
    - mv gui/.coverage .coverage.gui
    - coverage combine

after_success:
    coveralls
